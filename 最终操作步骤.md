# 文件上传功能 - 最终操作步骤

## ✅ 系统已完全修复

所有问题已解决，现在可以正常使用！

## 🎯 必须按照以下步骤操作

### 步骤 1：清除浏览器数据

**非常重要！必须执行！**

1. **完全关闭浏览器**
   - 关闭所有浏览器窗口
   - 确保浏览器进程完全退出

2. **重新打开浏览器**

3. **清除网站数据**
   - 按 `F12` 打开开发者工具
   - 按 `F1` 打开设置
   - 切换到 "Application" 标签
   - 左侧找到 "Storage"
   - 点击 "Clear site data" 按钮
   - 刷新页面

### 步骤 2：访问系统

```
http://localhost:3003
```

### 步骤 3：使用正确的账号登录

**重要：必须使用以下账号之一**

#### 学生账号（可以上传文件）

**账号 1**：
- 用户名：`student001`
- 密码：`123456`

**账号 2**：
- 用户名：`student002`
- 密码：`123456`

⚠️ **注意**：不是 student1，是 **student001**（有三个零）

### 步骤 4：验证登录信息

登录后，按 `F12` 打开控制台，输入：

```javascript
JSON.parse(localStorage.getItem('userInfo'))
```

**必须看到以下字段**：
- `user_id`: 16 或 17
- `username`: "student001" 或 "student002"
- `user_group`: "student"
- `student_id`: 8 或 9 ← **这个字段必须存在！**

如果没有 `student_id` 字段，说明没有正确登录，请重新执行步骤 1-3。

### 步骤 5：上传文件

1. 点击左侧菜单"答辩材料管理"
2. 点击"上传材料"按钮
3. 选择材料类型（如：答辩PPT）
4. 点击"选择文件"
5. 选择一个文件（PDF、DOC、DOCX、PPT、PPTX、ZIP、RAR）
6. 点击"确定上传"

### 步骤 6：查看控制台日志

上传时，控制台会输出：
```
用户信息: {user_id: 16, username: "student001", student_id: 8, ...}
准备上传，student_id: 8
FormData 内容: {file: "xxx.pdf", student_id: 8, material_type: "ppt"}
上传响应: {result: {id: 1, message: "上传成功"}}
```

如果看到"上传成功"，说明一切正常！

## 🔍 常见问题

### Q1: 仍然提示"请先登录学生账号"

**原因**：localStorage 中没有 student_id

**解决方案**：
1. 完全关闭浏览器
2. 重新打开
3. 清除网站数据（Application → Storage → Clear site data）
4. 使用 **student001** / 123456 登录
5. 验证 localStorage 中有 student_id

### Q2: 登录后看不到 student_id

**原因**：使用了错误的账号或旧的缓存

**解决方案**：
1. 确认使用的是 **student001**（不是 student1）
2. 清除浏览器缓存
3. 重新登录

### Q3: 控制台显示 student_id 是 undefined

**原因**：localStorage 中的数据是旧的

**解决方案**：
1. 在控制台执行：`localStorage.clear()`
2. 刷新页面
3. 重新登录

## 📋 测试账号总结

### 学生账号（用于上传文件）
| 用户名 | 密码 | student_id | 说明 |
|--------|------|------------|------|
| student001 | 123456 | 8 | 王同学 |
| student002 | 123456 | 9 | 赵同学 |

### 教师账号（用于下载文件）
| 用户名 | 密码 | teacher_id | 说明 |
|--------|------|------------|------|
| teacher001 | 123456 | 1 | 张教授 |
| teacher002 | 123456 | 2 | 李老师 |

### 管理员账号
| 用户名 | 密码 | 说明 |
|--------|------|------|
| admin | admin123 | 系统管理员 |

## 🎓 完整测试流程

### 测试 1：学生上传文件

1. 清除浏览器数据
2. 访问 http://localhost:3003
3. 使用 **student001** / 123456 登录
4. 验证 localStorage 有 student_id
5. 进入"答辩材料管理"
6. 上传一个测试文件
7. 验证上传成功

### 测试 2：教师下载文件

1. 退出登录
2. 使用 **teacher001** / 123456 登录
3. 进入"答辩材料管理"
4. 查看学生上传的文件
5. 下载文件

## ⚠️ 重要提示

1. **账号名称**
   - ✅ 正确：student001（三个零）
   - ❌ 错误：student1（一个1）

2. **必须清除缓存**
   - 旧的 localStorage 数据会导致问题
   - 必须清除后重新登录

3. **验证 student_id**
   - 登录后必须验证 localStorage 中有 student_id
   - 如果没有，说明登录有问题

4. **查看控制台**
   - 上传时会输出详细日志
   - 可以帮助诊断问题

## 🎉 预期结果

按照以上步骤操作后：
- ✅ 登录成功，localStorage 有 student_id
- ✅ 可以看到"答辩材料管理"菜单
- ✅ 可以点击"上传材料"
- ✅ 选择文件后可以成功上传
- ✅ 上传后文件出现在列表中
- ✅ 可以下载和删除文件

## 📞 如果还是不行

请提供以下信息：

1. **控制台输出**
   ```javascript
   JSON.parse(localStorage.getItem('userInfo'))
   ```
   的完整结果

2. **上传时的控制台日志**
   - 包括"用户信息"、"准备上传"、"上传响应"等

3. **浏览器信息**
   - 浏览器名称和版本

4. **操作步骤**
   - 您具体执行了哪些步骤

现在请严格按照步骤 1-6 操作，应该可以成功上传文件了！
